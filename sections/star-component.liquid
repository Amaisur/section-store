<style>

#shopify-section-{{ section.id }} i,.rating-container i:before {
    width: 64px;
    height: 64px;
    background-repeat: no-repeat !important;
    background-position: 0 0;
    background-size: 64px 64px;
    background-image: url(https://cdn.shopify.com/s/files/1/0562/7763/1105/files/svg-star.svg?v=1732888283);
    display: inline-block;
  }
  #shopify-section-{{ section.id }} i{
    position: relative;
  }
.rating-container i:before {
    content: none;
    display: none;
    position: absolute;
    top: 0;
    left: 0;
    width: var(--partial-width, 0);
}
.rating-container i.partial:before {
    content: "";
    display: block;
}

  
</style>


<div class="text-container">
  <div class="rating-container" ss-data-rating="5"></div>
  <div class="rating-container" ss-data-rating="3.4"></div>
  <div class="rating-container" ss-data-rating="1.2"></div>
</div>
<script>
    class StarRating {
        constructor(containerSelector) {
            this.containers = document.querySelectorAll(containerSelector);
            this.fullStar = `<i class="star full" style="background: url(https://cdn.shopify.com/s/files/1/0562/7763/1105/files/svg-star.svg?v=1732888283)"></i>`;
            this.halfStar = `<i class="star partial" style="background: url(https://cdn.shopify.com/s/files/1/0562/7763/1105/files/svg-0.svg?v=1732889585)"></i>`;
            this.emptyStar = `<i class="star empty" style="background: url(https://cdn.shopify.com/s/files/1/0562/7763/1105/files/svg-0.svg?v=1732889585)"></i>`;
        }

        renderStars() {
            // Iterate over each container and render the stars based on the rating attribute
            this.containers.forEach(container => {
                const rating = parseFloat(container.getAttribute('ss-data-rating'));

                // Ensure rating is between 0 and 5
                if (rating < 0 || rating > 5 || isNaN(rating)) {
                    console.error('Invalid rating value. Please provide a number between 0 and 5.');
                    return;
                }

                let starsHTML = ''; // Create an empty string to accumulate stars

                // Calculate number of full stars
                const fullStarsCount = Math.floor(rating);

                // Calculate the decimal part of the rating
                const decimalPart = rating % 1;

                // Determine if a half star is needed (any decimal part >= 0.1)
                let partialStar = '';
                let partialStarWidth = 0;
                if (decimalPart >= 0.1) {
                    partialStar = this.halfStar;
                    // The width of the partial star should be proportional to the fractional part
                    partialStarWidth = Math.round(decimalPart * 100);
                }

                // Calculate the number of empty stars
                const emptyStarsCount = 5 - fullStarsCount - (partialStar ? 1 : 0);

                // Add full stars
                starsHTML += this.fullStar.repeat(fullStarsCount);

                // Add partial star with a width attribute for the ::before pseudo-element
                if (partialStar) {
                    starsHTML += `<i class="star partial" style="background: url(https://cdn.shopify.com/s/files/1/0562/7763/1105/files/svg-0.svg?v=1732889585)" data-width="${partialStarWidth}"></i>`;
                }

                // Add empty stars
                starsHTML += this.emptyStar.repeat(emptyStarsCount);

                // Set the container's innerHTML with the accumulated stars
                container.innerHTML = starsHTML;

                // After rendering the stars, set the width of the ::before pseudo-element dynamically
                this.setPartialStarWidth();
            });
        }

        setPartialStarWidth() {
            // Loop through each partial star and set the width of the ::before pseudo-element
            document.querySelectorAll('.star.partial').forEach(star => {
                const width = star.getAttribute('data-width');
                if (width) {
                    // Set the width of the ::before pseudo-element
                    star.style.setProperty('--partial-width', `${width}%`);
                }
            });
        }
    }

    // Instantiate the StarRating class and render the stars for all containers
    const starRating = new StarRating('.rating-container');
    starRating.renderStars();
</script>


{% schema %}
{
  "name": "Star component",
  "settings": [],
  "presets": [
    {
      "name": "Star component"
    }
  ]
}
{% endschema %}
